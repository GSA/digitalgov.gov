{{/*

  Collection List Item
  Returns a list item variant for USWDS Collection

  @see see collection.html for description of other variables
  @param {boolean} link_external - apply `usa-link--external` class if url host is not www.digital.gov

*/}}
{{ $list_item := .list_item }}
{{ $variant := .variant }}
{{ $link_external := false }} {{/* TODO: fix external link logic to work on all environments */}}
{{ $logo_source := .logo_source }}
{{ $list_header := .list_header }}
{{ $title := .title }}
{{ $href := .href }}
{{ $url := urls.Parse $href }}
{{ $meta_source := .meta_source }}
{{ $list_default_width := .list_default_width }}
{{ $is_truncated := .is_truncated }}

{{- with .list_item -}}
  {{ $path := "" }}{{ with .File }}
    {{ $path = .Path }}
  {{ else }}
    {{ $path = .Path }}
  {{ end }}

  <li class="usa-collection__item{{ if not $list_default_width }} usa-collection__item--full-width{{ end }}" data-edit-this="{{- $path -}}">
    {{ if or (eq $variant "media") (eq $variant "custom") }}
      {{- partial "core/collection/collection-icon" (dict "logo_source" $logo_source) -}}
    {{ end }}
    <div class="usa-collection__body">
      <h{{ $list_header | safeHTML }} class="usa-collection__header">
        {{ if .Title }}
          <a class="usa-link {{ if $link_external }}usa-link--external{{ end }}" href="{{- $href -}}" title="{{- .Title | markdownify -}}">
            {{- .Title | markdownify -}}
          </a>
        {{ end }}
        {{ if $title }}
          <a class="usa-link {{ if $link_external }}usa-link--external{{ end }}" href="{{- $href -}}" title="{{- $title | markdownify -}}">
            {{- $title | markdownify -}}
          </a>
        {{ end }}
      </h{{ $list_header | safeHTML }}>
      {{ if ne $variant "headings" }}
        <p class="usa-collection__description">
          {{- if .Params.summary -}}
            {{- if .Params.is_truncated -}}
              {{- .Params.summary | markdownify | truncate 140 -}}
            {{ else }}
              {{- .Params.summary | markdownify -}}
            {{ end }}
          {{- else -}}
            {{- .Params.deck | markdownify -}}
          {{- end -}}
        </p>
      {{ else }}
        {{ if $meta_source }}
          <ul class="usa-collection__meta">
            <li class="usa-collection__meta-item position-relative">
              <svg
                class="usa-icon position-relative bottom-neg-2px"
                aria-hidden="true"
                role="img"
              >
                <use
                  xlink:href="{{ "uswds/img/sprite.svg#public" | relURL }}"
                ></use>
              </svg>
              {{- $meta_source -}}
            </li>
          </ul>
        {{ end }}
      {{ end }}
    </div>
  </li>
{{- end -}}
