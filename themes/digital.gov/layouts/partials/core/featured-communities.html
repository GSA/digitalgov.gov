{{/* Digital.gov Communities Component
  Renders a list of Digital.gov communities on both the home page and communities page

  @param {object} context - Parent scope context object
  @param {string} layout  - Set the styles for the cards depending if displayed on the home or communities page
  - Values can be "home" for homepage styles or "communities" for communities page
  - "communities" layout displays community image logo and button outline styles
*/}}

{{ $context := .context }}
{{ $layout := .layout }}

{{ $page_header := $context.Site.GetPage "/communities" }}
{{ $communities := (where $context.Site.Pages "Section" "communities").ByTitle }}
{{ $communities = (where $communities ".Params.weight" "ge" 1) }}
{{ $dg_communities := (where $communities ".Params.dg_highlight" "eq" true) }}
{{/* featured community is listed first, followed by the other dg 7 listed alphabetically by title */}}
{{ $featured_community := (where $communities ".Params.weight" "eq" 2) }}
{{ $dg_communities = union $featured_community $dg_communities }}


<div class="page-head">
  {{ with $page_header }}
    <h1>{{- .Title | markdownify -}}</h1>
    {{- if .Params.deck -}}
      <div class="deck">{{- .Params.deck | markdownify -}}</div>
    {{- end -}}
  {{ end }}
</div>

<div
  class="dg-featured-communities dg-featured-communities--{{- if $layout -}}
    {{ $layout }}
  {{- end -}}"
>
  {{ range $dg_communities }}
    {{ $path := "" }}
    {{ with .File }}
      {{ $path = .Path }}
    {{ else }}
      {{ $path = .Path }}
    {{ end }}
    <div
      class="usa-card{{ if .Params.dg_acronym }}
        cop-card--{{ .Params.dg_acronym }}
      {{ end }}"
    >
      {{ $card_data := (dict "header" .Params.dg_shortname "body" .Params.summary "link" .Permalink "link_title" (printf "%s%s" "Connect with <br/>" .Params.dg_shortname) "image" .Params.dg_logo "alt" (printf "%s%s" .Params.dg_shortname " logo") "layout" $layout "path" $path) }}
      {{- partial "core/usa-card.html" (dict "card_data" $card_data) -}}
    </div>
  {{ end }}
</div>
