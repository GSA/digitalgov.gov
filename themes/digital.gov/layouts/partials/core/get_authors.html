{{/* Displays the author circular image and name next to it
  Long layout is used on events and news single.html
  Short layout is used on card-*.html

  @param {page object} data - hugo page object that contains the associated authors for a post
  @param {string} layout - layout variant to display, short will display image and full name while long will display agency and location.
  @param {boolean} isShort - flag to toggle between short and long variant to display
*/}}
{{ $data := .data }}
{{ $layout := .layout }}

{{ $isShort := true }}
{{ if eq $layout "long" }}
  {{ $isShort = false }}
{{ end }}

{{- if $data.Params.authors -}}
  <div class="authors-list {{ if $isShort }}authors-list-short{{ end }}">
    {{- $authors_count := $data.Params.authors | len -}}

    {{- range $i, $e := $data.Params.authors -}}
      {{- $uid := . -}}

      {{/* If the byline was entered as a display name (i.e. - John Smith )
        then this will turn that into a UID for use in a URL.
      */}}
      {{- $uid := $e | urlize -}}

      {{/* Lets look up the author data, based on the UID. Should equal the filename */}}
      {{- with $data.Site.GetPage (printf "/%s/%s" "authors" $uid) -}}

        {{ if $isShort }}
          <a
            class="author"
            href="{{- (printf "authors/%s/" $uid) | absURL -}}"
            rel="author"
          >
            {{- partial "core/get_author_image.html" (dict "author" . ) -}}
            <span class="usa-sr-only">Posts by</span>
            <span
              >{{- .Params.display_name | default $uid | markdownify -}}</span
            > </a
          >{{ if lt (add $i 1) $authors_count }}<!--,-->{{ end }}

        {{ else }}
          <div class="author grid-row">
            <div class="grid-col-auto">
              <div class="photo">
                {{- partial "core/get_author_image.html" (dict "author" . ) -}}
              </div>
            </div>
            <div class="grid-col-9">
              <div class="details">
                <span class="usa-sr-only">
                  Originally posted by
                  {{ .Params.display_name | default $uid }}
                  on
                  {{ $.Date.Format "Jan 2, 2006" }}
                </span>
                <a
                  href="{{ (printf "authors/%s/" $uid) | absURL }} "
                  title="Posts by {{ .Params.display_name | default $uid }}"
                  rel="author"
                  aria-label="Read more articles by {{ .Params.display_name | default $uid }}"
                >
                  {{- .Params.display_name | default $uid -}}
                </a>
                {{- if .Params.agency -}}
                  <p>
                    {{- .Params.agency -}}{{- if .Params.location -}}
                      &nbsp;|&nbsp;{{- .Params.location -}}
                    {{- end -}}
                  </p>
                {{- end -}}

              </div>
            </div>
          </div>
        {{ end }}
      {{- end -}}

    {{- end -}}
  </div>
{{- end -}}
