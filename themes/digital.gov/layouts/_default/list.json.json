{{- partial "core/set-env.html" . -}}
{{- $list := .Data.Pages -}}
{{- $length := (len $list) -}}
{
    "version" : "https://jsonfeed.org/version/1",
    "content" : "{{- .Type -}}",
    "type" : "list",
    "title" : "{{- if eq  .Title  .Site.Title -}}{{- .Site.Title -}}{{- else -}}{{- with .Title -}} {{.}} |  {{- end -}} {{- .Site.Title -}} {{- end -}}",
    "description": "{{- if ne  .Title  .Site.Title -}}{{- with .Title -}}{{.}}{{- end -}}{{- end -}}",
    "home_page_url" : "{{- .Site.BaseURL -}}",
    "count" : "{{- $length -}}",
    {{- with .OutputFormats.Get "JSON" -}}
    "feed_url" : "{{- .Permalink -}}",
    {{- end -}}
    {{- with $.Param "icon" -}}
    "icon" : "{{- . | absURL -}}",
    {{- end -}}
    {{- with $.Param "favicon" -}}
    "favicon" : "{{- . | absURL -}}",
    {{- end -}}
    {{- with .Site.Author.name -}}
    "author" : {
        "name" : "{{- . -}}"{{- with $.Site.Author.Params.url -}},
        "url": "{{- . -}}"{{- end -}}{{- with $.Site.Author.avatar -}},
        "avatar": "{{- . | absURL -}}"{{- end -}}
    },
    {{- end -}}
    {{ with .Section }}
    "section" : "{{ . }}",
    {{ end }}
    {{ with eq .Kind  "taxonomy"}}
    "taxonomy" : "{{ $.Data.Singular }}",
    "term" : "{{ $.Data.Term }}",
    {{ end }}
    "items" : [
    {{- range $index, $element := $list -}}
    {
      {{- if (isset .Params "kicker") -}}
      "kicker" : "{{- .Params.kicker -}}",
      {{- end -}}
      "title" : {{- .Title | jsonify -}},
      {{- if (isset .Params "deck") -}}
      "deck" : "{{- .Params.deck | markdownify -}}",
      {{- end -}}
      {{- if (isset .Params "summary") -}}
      "summary" : "{{- .Params.summary | markdownify -}}",
      {{- end -}}
      "date" : "{{- .Date.Format "2006-01-02T15:04:05" -}}-0500",
      {{- if .Lastmod -}}
      "date_modified" : "{{- .Lastmod.Format "2006-01-02T15:04:05Z07:00" -}}",
      {{- else -}}
      "date_modified" : "{{- .Date.Format "2006-01-02T15:04:05Z07:00" -}}", -}}",
      {{- end -}}
      {{- if (isset .Params "guide") -}}
      "guide" : "{{- .Params.guide -}}",
      {{- end -}}
      {{- if (isset .Params "guide_weight") -}}
      "guide_weight" : "{{- .Params.guide_weight -}}",
      {{- end -}}
      {{- if (isset .Params "image") -}}
      "image" : "{{- .Params.image -}}",
      {{- end -}}
      {{- if .Params.weight -}}
      "weight" : "{{- .Params.weight -}}",
      {{- end -}}

      {{- if .Params.source -}}
      "source" : "{{- .Params.source -}}",
      {{- end -}}
      {{- if .Params.source_url -}}
      "source_url" : "{{- .Params.source_url -}}",
      {{- end -}}

      {{- partial "api/authors.html" . -}}

      {{- partial "api/topics.html" . -}}

      {{- partial "api/primary_image.html" . -}}

      {{- partial "api/featured_image.html" . -}}

      {{- partial "api/file-info.html" . }}

      {{- partial "api/aliases.html" . -}}

      {{- partial "api/slug.html" . -}}


    }{{- if ne (add $index 1) $length -}},{{- end -}}
    {{- end -}}
    ]
}
