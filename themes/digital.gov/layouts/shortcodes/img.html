{{/* ======= 
  Displays an image using Hugo's image processing
  See wiki for more details https://github.com/GSA/digitalgov.gov/wiki/Hugo-shortcodes

  align - set the alignment for the image to be left (default if left blank), center, or right aligned.
  inline - displays multiples images on same line

  @example for right aligned image
  {{< img src="images/my-image.jpg" align="right" alt="UX Summit Image" >}}

  @example for two images on same line starting justified left align
  {{< img src="images/image-1.jpg" align="center" inline="true" alt="UX Summit Image 1" >}}
  {{< img src="images/image-2.jpg" align="center" inline="true" alt="UX Summit Image 2" >}}
*/}}

{{- $src := .Get "src" -}}
{{- $align := .Get "align" | default "" -}}
{{- $inline := .Get "inline" | default "false" -}}
{{- $alt := .Get "alt" -}}

{{ $imageClasses := slice "image" }}
{{ if $align }}
  {{ $imageClasses = $imageClasses | append (printf "image-%s" $align) }}
{{ end }}
{{ if eq $inline "true" }}
  {{ $imageClasses = $imageClasses | append "image-inline" }}
{{ end }}
{{ if eq $align "center" }}
  {{ $imageClasses = $imageClasses | append "image-center" }}
{{ end }}

<div class="{{ delimit $imageClasses " " }}">

  {{/* Check for local image first */}}
  {{ $image := resources.Get $src }}
  {{ if $image }}
      {{/* Process local image with responsive resizing */}}
      {{ $image1200x := $image.Resize "1200x" }}
      {{ $image800x := $image.Resize "800x" }}
      <img
          src="{{ $image1200x.RelPermalink }}"
          srcset="{{ $image800x.RelPermalink }} 800w, {{ $image1200x.RelPermalink }} 1200w"
          sizes="(max-width: 800px) 100vw, (max-width: 1200px) 100vw, 100vw"
          {{ with $alt }}alt="{{ . }}"{{ end }}
          {{ with $image.Height }}height="{{ . }}"{{ end }}
          {{ with $image.Width }}width="{{ . }}"{{ end }}
      >
  {{ else if hasPrefix $src "http" }}
      {{/* Fallback to external image if not found locally */}}
      <img src="{{ $src }}" {{ with $alt }}alt="{{ . }}"{{ end }}>
  {{ else }}
      {{/* Fallback to the original src path if image is missing */}}
      <img src="/images/{{ $src }}" {{ with $alt }}alt="{{ . }}"{{ end }}>
  {{ end }}

  {{/* Image metadata from data/images if available */}}
  {{- $thisuid := $src | lower | replaceRE "\\.[jpegpn]{3,4}$" "" -}}
  {{- with index $.Site.Data.images $thisuid -}}
    {{- with .caption -}}
      <p>
        {{ . | markdownify }}
        {{- with $.credit -}}
          <span>â€”&nbsp;{{ . | markdownify }}</span>
        {{- end }}
      </p>
    {{- end }}
  {{- end -}}

</div>
