{{/* =======
  Displays an image at 800 or 1200 width with optional metadata
  See wiki for more details https://github.com/GSA/digitalgov.gov/wiki/Hugo-shortcodes

  align - set the alignment for the image to be left (default if left blank), center, or right aligned.
  inline - displays multiples images on the same line

  @example for right aligned image
  {{< img src="image-1" align="right" alt="UX Summit Image" >}}

  @example for two images on same line starting justified left align
  {{< img src="image-1" align="center" inline="true" alt="UX Summit Image 1" >}}
  {{< img src="image-2" align="center" inline="true" alt="UX Summit Image 2" >}}
*/}}

<!-- image -->
{{- $thisuid := (.Get "src" | lower) -}}
{{- $thisuid := replaceRE "\\.[jpegpn]{3,4}$" "" $thisuid -}}
{{- $thisimg := index $.Site.Data.images $thisuid -}}
{{- $imgExt := $thisimg.format -}}
{{- $align := .Get "align" | default "" -}}
{{- $inline := .Get "inline" | default "false" -}}

{{ $imageClasses := slice "image" }}
{{ if $align }}
  {{ $imageClasses = $imageClasses | append (printf "image-%s" $align) }}
{{ end }}
{{ if eq $inline "true" }}
  {{ $imageClasses = $imageClasses | append "image-inline" }}
{{ end }}
{{ if eq $align "center" }}
  {{ $imageClasses = $imageClasses | append "image-center" }}
{{ end }}

{{ $imagePath := printf "images/%s.%s" $thisuid $imgExt }}
{{ with resources.Get $imagePath }}
  <div class="{{ delimit $imageClasses " " }}">
    <img
      src="{{ .RelPermalink }}"
      {{- if or ($.Get "alt") $thisimg.alt -}}
        alt="{{- with $.Get "alt" -}}
          {{- . -}}
        {{- else -}}
          {{- $thisimg.alt -}}
        {{- end -}}"
      {{- end -}}
    />
    {{- if or $thisimg.caption $thisimg.credit -}}
      <p>
        {{- $thisimg.caption | markdownify -}}
        {{- if $thisimg.credit -}}
          <span>â€”&nbsp;{{ $thisimg.credit | markdownify -}}</span>
        {{- end -}}
      </p>
    {{- end -}}
  </div>
{{ else }}
  <!-- Log error if image not found -->
  {{ errorf "Image not found: %s" $imagePath }}
{{ end }}
<!-- image -->