{{/* =======
  Generic image shortcode with responsive image support
  
  Parameters:
  - src: path to the image (required)
  - alt: alt text for accessibility (required)
  - align: alignment (left/center/right, optional)
  - inline: display inline with other images (true/false, optional)
  - caption: image caption (optional)
  - credit: image credit (optional)
  
  @example
  {{< img src="path/to/image.jpg" alt="Description" align="center" caption="My caption" credit="Photo by John Doe" >}}
*/}}

{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" -}}
{{- $align := .Get "align" | default "left" -}}
{{- $inline := .Get "inline" | default "false" -}}
{{- $caption := .Get "caption" -}}
{{- $credit := .Get "credit" -}}

{{ $imageClasses := slice "image" }}
{{ if $align }}
  {{ $imageClasses = $imageClasses | append (printf "image-%s" $align) }}
{{ end }}
{{ if eq $inline "true" }}
  {{ $imageClasses = $imageClasses | append "image-inline" }}
{{ end }}

<div class="{{ delimit $imageClasses " " }}">
  {{ $image := resources.Get $src }}
  {{ if $image }}
    {{/* Process local image with responsive resizing */}}
    {{ $image1200x := $image.Resize "1200x" }}
    {{ $image800x := $image.Resize "800x" }}
    <img
      src="{{ $image1200x.RelPermalink }}"
      srcset="{{ $image800x.RelPermalink }} 800w, {{ $image1200x.RelPermalink }} 1200w"
      sizes="(max-width: 800px) 100vw, 1200px"
      alt="{{ $alt }}"
      {{ with $image.Height }}height="{{ . }}"{{ end }}
      {{ with $image.Width }}width="{{ . }}"{{ end }}
    >
  {{ else if hasPrefix $src "http" }}
    {{/* External image */}}
    <img src="{{ $src }}" alt="{{ $alt }}">
  {{ else }}
    {{/* Static image */}}
    <img src="/images/{{ $src }}" alt="{{ $alt }}">
  {{ end }}

  {{/* Optional caption and credit */}}
  {{ if or $caption $credit }}
    <p class="image-meta">
      {{ with $caption }}{{ . | markdownify }}{{ end }}
      {{ if and $caption $credit }} â€” {{ end }}
      {{ with $credit }}{{ . | markdownify }}{{ end }}
    </p>
  {{ end }}
</div>
