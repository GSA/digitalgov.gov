{{- partial "core/set-env.html" . -}}
{{- $list := .Data.Pages -}}
{{- $length := (len $list) -}}
{
    "version" : "https://jsonfeed.org/version/1",
    "content" : "sources",
    "type" : "list",
    "home_page_url" : "{{- .Site.BaseURL -}}",
    "count" : "{{- $length -}}",
    {{- with .OutputFormats.Get "JSON" -}}
    "feed_url" : "{{- .Permalink -}}",
    {{- end -}}
    "items" : [
    {{- range $index, $element := $list -}}
    {

        {{- partial "api/metadata" . -}}
        {{- if (isset .Params "name") -}}
        "name" : "{{- .Params.name | markdownify -}}",
        {{- end -}}
        {{- if (isset .Params "summary") -}}
        "summary" : "{{- replace .Params.summary "\n" "\\n" -}}",
        {{- end -}}
        {{- if (isset .Params "domain") -}}
        "domain" : "{{- .Params.domain -}}",
        {{- end -}}
        {{- if (isset .Params "icon") -}}
        "icon" : "{{- .Params.logo -}}",
        {{- end -}}
        {{- if (isset .Params "weight") -}}
        "weight" : "{{- .Params.weight -}}",
        {{- end -}}
        {{- partial "api/topics" . -}}
        {{- partial "api/file-info.html" . -}}
        {{- partial "api/slug.html" . -}}
    }{{- if ne (add $index 1) $length -}},{{- end -}}
    {{- end -}}
    ]
}
